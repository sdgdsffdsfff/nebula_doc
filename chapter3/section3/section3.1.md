# 3.3.1. 场景介绍


对于公司业务细分到不同的场景,  再到定制策略,  以及`TH-Nebula`脚本可能会有些模糊,  对于一开始认识`TH-Nebula`系统可能会对此概念模糊不清,  所以接下来对于不同的场景分别制定策略,  来深入了解策略的定制,  以及`TH-Nebula`脚本的定制.

## IP撞库登陆
假设同一个`IP`, 不断的用不同的账号或者密码一直访问登陆页面,  那么设定次数之后就可以捕获到这个`IP`, 之后对此`IP`进行弹验证码, 封`IP`等处理.

### 策略的制定

首先对公司的登陆接口在新建策略的时候, 以 [事件-动态资源请求] 选定属性 [`page`] , 也就是`URL`中包含了` login` 字段的, 即认定为登陆接口, 此处要根据公司的登陆接口做相应的改变, 每家公司业务的登陆接口不尽相同.
在 ①处填公司的登陆接口

![4.撞库登陆策略配置1](http://wx1.sinaimg.cn/large/0060lm7Tly1fxnn7rv3uij317z0diwg7.jpg)

接下来选择点击图片中②所全选的＋号, 选择 [`条件判断`-`条件统计`-`动态资源请求`]

![5.撞库登陆策略配置2](http://wx4.sinaimg.cn/large/0060lm7Tly1fxnnah8wggj30ps0bp0u0.jpg)

然后编辑参数, 选择同一个`IP`的访问次数, 这样才可以达到计算的效果

![6.撞库登陆策略配置3](http://wx3.sinaimg.cn/large/0060lm7Tly1fxnncg4iydj30ri0fb769.jpg)

以上是实时计算5分钟内统计同一`IP`访问登陆接口则对次`IP`进行判定为审核或者是黑名单,  通过`TH-Nebula`查询接口可以查询到黑名单, 审核名单, 可以对其做进一步处理.

##  IP大量请求却不加载静态资源

假设一个`IP`大量的请求却不加载静态资源,  那么可以认定此`IP`是通过机器程序登陆的操作的, 只对接口访问, 这种`IP`存在一定的风险.

### 策略的制定

选择新建策略, 选择 [`事件`-`动态资源请求`] 选定属性`c_ip`, 包含  [ . ]  , 这样表达的意思是所有的`IP`都会被捕获到, 接下来通过条件筛选出同一个`IP`大量请求却不加载静态资源的`IP`.

![7.IP大量请求策略配置1](http://wx2.sinaimg.cn/large/0060lm7Tly1fxnndt8p62j30zx0ev40g.jpg)

选择 [`条件判断`-`条件统计`-`IP请求量5M`] 然后编辑参数设定为 [`c_ip`] 大于50,  表示在5分钟内某个相同的`IP`访问50次网站
接下来选择 [`条件判断`-`条件统计`-`静态资源请求量`]  编辑参数设定 [`c_ip`] 等于  [0]

![8.IP大量请求策略配置2](http://wx1.sinaimg.cn/large/0060lm7Tly1fxnnf6zj59j30zv0g1q57.jpg)
这样设定就可以判断出同一个`IP`在5分钟内大量请求接口却不加载静态资源, 进行判定为审核或者是黑名单,  通过`TH-Nebula`查询接口可以查询到黑名单, 审核名单, 可以对其做进一步处理.

## IP关联多个用户

假设一个`IP`以多个用户登陆,  那么可以认定此`IP`是通过机器程序操作多个用, 这种`IP`存在一定的风险.

### 策略的制定

选择新建策略, 选择 [`事件`-`动态资源请求`] 选定属性 [`c_ip`] , 包含  [ . ]  , 这样表达的意思是所有的`IP`都会被捕获到, 接下来通过条件筛选出同一个`IP`关联多个用户

![9.IP关联多用户策略配置1](http://wx3.sinaimg.cn/large/0060lm7Tly1fxnngxgjukj310h0cgmyd.jpg)

随后增加条件筛选

![10.IP关联多用户策略配置2](http://wx3.sinaimg.cn/large/0060lm7Tly1fxnnknu0ezj310u0e075w.jpg)

需要注意编辑参数

![11.IP关联多用户策略配置3](http://wx4.sinaimg.cn/large/0060lm7Tly1fxnnllmmafj31070ewtak.jpg)

之后增加处置措施

![12.IP关联多用户策略配置4](http://wx4.sinaimg.cn/large/0060lm7Tly1fxnnmo9lnkj31090hkwh3.jpg)


以上三个例子从3个不同的业务场景说明了制定场景的方法, 希望可以从这些例子帮助到理解根据业务制定策略.
